<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Seraph Browser</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI;
  background:#0f0f0f;
  color:white;
  overflow:hidden;
}

/* Sidebar */
.switcher{
  position:fixed;
  left:15px;
  top:50%;
  transform:translateY(-50%);
  background:white;
  border-radius:50px;
  padding:10px 6px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:9999;
}
.switcher button{
  border:none;
  background:none;
  font-size:20px;
  cursor:pointer;
}

/* Tabs */
.tabs{
  display:flex;
  gap:6px;
  padding:8px 80px 8px 70px;
  background:#151515;
}
.tab{
  background:#222;
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
}
.tab.active{background:#444}

/* Topbar */
.topbar{
  display:flex;
  gap:8px;
  padding:8px 80px 8px 70px;
  background:#181818;
}
.topbar button{
  background:#222;
  border:none;
  color:white;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}
.url{
  flex:1;
  padding:6px 10px;
  border-radius:6px;
  border:none;
  background:#222;
  color:white;
}

/* iframe */
iframe{
  width:100%;
  height:calc(100vh - 110px);
  border:none;
}

/* Home */
.home{
  display:flex;
  height:calc(100vh - 110px);
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:15px;
}
.search{
  padding:12px 18px;
  width:400px;
  max-width:80%;
  border-radius:50px;
  border:none;
  background:#222;
  color:white;
}

/* Panic button */
.panic{
  position:fixed;
  bottom:20px;
  right:20px;
  width:65px;
  height:65px;
  border-radius:50%;
  background:red;
  color:white;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="switcher">
  <button onclick="goHome()">üè†</button>
  <button onclick="location.href='proxy.html'">üåê</button>
</div>

<!-- Tabs -->
<div id="tabs" class="tabs"></div>

<!-- Toolbar -->
<div class="topbar">
  <button onclick="back()">‚Üê</button>
  <button onclick="forward()">‚Üí</button>
  <button onclick="refresh()">‚ü≥</button>
  <input id="url" class="url" placeholder="Search or enter URL">
  <button onclick="load()">Go</button>
</div>

<!-- Home -->
<div id="home" class="home">
  <h1>Seraph Browser</h1>
  <input id="homeSearch" class="search" placeholder="Search the web">
</div>

<iframe id="frame"></iframe>

<button class="panic" onclick="escapeNow()">ESCAPE</button>

<script>
const frame = document.getElementById("frame");
const tabsEl = document.getElementById("tabs");
const home = document.getElementById("home");
const urlBox = document.getElementById("url");

let tabs = [];
let currentTab = -1;

/* Create tab */
function newTab(url=""){
  tabs.push({url, history:[], index:-1});
  currentTab = tabs.length-1;
  renderTabs();
  if(url) navigate(url);
}

/* Render tabs */
function renderTabs(){
  tabsEl.innerHTML="";
  tabs.forEach((t,i)=>{
    const el=document.createElement("div");
    el.className="tab"+(i===currentTab?" active":"");
    el.textContent=t.url ? new URL(t.url).hostname : "New Tab";
    el.onclick=()=>switchTab(i);
    tabsEl.appendChild(el);
  });
}

/* Switch tab */
function switchTab(i){
  currentTab=i;
  const tab=tabs[i];
  if(tab.url){
    home.style.display="none";
    frame.style.display="block";
    frame.src=getProxyUrl(tab.url);
  }
  renderTabs();
}

/* Load URL */
function load(){
  let val=urlBox.value.trim();
  if(!val) return;

  if(!val.startsWith("http")){
    val="https://duckduckgo.com/?q="+encodeURIComponent(val);
  }
  navigate(val);
}

/* Navigate using Netlify proxy */
function navigate(url){
  const tab=tabs[currentTab];
  tab.url=url;
  tab.history.push(url);
  tab.index++;

  frame.src=getProxyUrl(url);

  home.style.display="none";
  frame.style.display="block";
  renderTabs();
  disguise();
}

/* Proxy helper */
function getProxyUrl(url){
  return `/.netlify/functions/proxy?url=${encodeURIComponent(url)}`;
}

/* Controls */
function back(){
  const t=tabs[currentTab];
  if(t.index>0){
    t.index--;
    frame.src=getProxyUrl(t.history[t.index]);
  }
}
function forward(){
  const t=tabs[currentTab];
  if(t.index<t.history.length-1){
    t.index++;
    frame.src=getProxyUrl(t.history[t.index]);
  }
}
function refresh(){
  frame.src = frame.src;
}

/* Panic */
function escapeNow(){
  location.href="https://classroom.google.com";
}

/* Home */
function goHome(){
  home.style.display="flex";
  frame.style.display="none";
}

/* Home search */
document.getElementById("homeSearch").addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    urlBox.value=e.target.value;
    load();
  }
});

/* Enter key support */
urlBox.addEventListener("keydown",e=>{
  if(e.key==="Enter") load();
});

/* Tab disguise */
function disguise(){
  document.title="Google Docs";
  const link=document.createElement("link");
  link.rel="icon";
  link.href="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico";
  document.head.appendChild(link);
}

/* Init */
newTab();
</script>

</body>
</html>
