<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Seraph Browser</title>
<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,sans-serif;
  background:#0f0f0f;
  color:white;
  overflow:hidden;
}

/* Sidebar (matches index.html) */
.switcher{
  position:fixed;
  left:18px;
  top:50%;
  transform:translateY(-50%);
  background:white;
  border-radius:999px;
  padding:10px 6px;
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  z-index:9999;
}
.switcher button{
  width:38px;
  height:38px;
  border:none;
  background:none;
  cursor:pointer;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.15s;
}
.switcher button:hover{
  background:#f2f2f2;
}

/* Tabs */
.tabs{
  display:flex;
  gap:6px;
  padding:8px 80px 8px 80px;
  background:#151515;
}
.tab{
  background:#222;
  padding:6px 10px;
  border-radius:8px;
  font-size:13px;
  cursor:pointer;
}
.tab.active{background:#444}

/* Topbar */
.topbar{
  display:flex;
  gap:8px;
  padding:8px 80px;
  background:#181818;
}
.topbar button{
  background:#222;
  border:none;
  color:white;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}
.url{
  flex:1;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  background:#222;
  color:white;
}

/* iframe */
iframe{
  width:100%;
  height:calc(100vh - 110px);
  border:none;
}

/* Home */
.home{
  display:flex;
  height:calc(100vh - 110px);
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:15px;
}
.search{
  padding:12px 18px;
  width:400px;
  max-width:80%;
  border-radius:999px;
  border:none;
  background:#222;
  color:white;
}

/* Panic button */
.panic{
  position:fixed;
  bottom:20px;
  right:20px;
  width:65px;
  height:65px;
  border-radius:50%;
  background:red;
  color:white;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="switcher">
  <button onclick="location.href='index.html'" title="Home">
    <!-- House icon -->
    <svg width="18" height="18" viewBox="0 0 24 24">
      <path d="M3 10.5L12 3l9 7.5v9a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1z"
      fill="#111"/>
    </svg>
  </button>
  <button title="Browser">
    <!-- Globe icon -->
    <svg width="18" height="18" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" stroke="#111" stroke-width="2" fill="none"/>
      <path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18"
      stroke="#111" stroke-width="1.5" fill="none"/>
    </svg>
  </button>
</div>

<!-- Tabs -->
<div id="tabs" class="tabs"></div>

<!-- Toolbar -->
<div class="topbar">
  <button onclick="back()">←</button>
  <button onclick="forward()">→</button>
  <button onclick="refresh()">⟳</button>
  <input id="url" class="url" placeholder="Search or enter URL">
  <button onclick="load()">Go</button>
</div>

<!-- Home -->
<div id="home" class="home">
  <h1>Seraph Browser</h1>
  <input id="homeSearch" class="search" placeholder="Search the web">
</div>

<iframe id="frame"></iframe>
<button class="panic" onclick="escapeNow()">ESCAPE</button>

<script>
const frame = document.getElementById("frame");
const home = document.getElementById("home");
const urlBox = document.getElementById("url");
const tabsEl = document.getElementById("tabs");

let tabs = [];
let currentTab = -1;

/* Proxy helper */
function proxy(url){
  return `/.netlify/functions/proxy?url=${encodeURIComponent(url)}`;
}

/* Tab system */
function newTab(url=""){
  tabs.push({url, history:[], index:-1});
  currentTab = tabs.length-1;
  renderTabs();
  if(url) navigate(url);
}

function renderTabs(){
  tabsEl.innerHTML = "";
  tabs.forEach((t,i)=>{
    const el = document.createElement("div");
    el.className = "tab"+(i===currentTab?" active":"");
    el.textContent = t.url ? new URL(t.url).hostname : "New Tab";
    el.onclick = ()=>switchTab(i);
    tabsEl.appendChild(el);
  });
}

function switchTab(i){
  currentTab = i;
  const t = tabs[i];
  if(t.url){
    frame.src = proxy(t.url);
    home.style.display = "none";
  }
  renderTabs();
}

/* Navigation */
function navigate(url){
  const t = tabs[currentTab];
  t.url = url;
  t.history.push(url);
  t.index++;
  frame.src = proxy(url);
  home.style.display = "none";
  renderTabs();
}

/* Load */
function load(){
  let val = urlBox.value.trim();
  if(!val) return;
  const looksLikeUrl = val.includes(".") && !val.includes(" ");
  if(looksLikeUrl && !val.startsWith("http")) val = "https://" + val;
  if(!val.startsWith("http")) val = "https://duckduckgo.com/?q=" + encodeURIComponent(val);
  navigate(val);
}

/* Controls */
function back(){
  const t = tabs[currentTab];
  if(t.index>0){ t.index--; frame.src = proxy(t.history[t.index]); }
}
function forward(){
  const t = tabs[currentTab];
  if(t.index < t.history.length-1){ t.index++; frame.src = proxy(t.history[t.index]); }
}
function refresh(){ frame.src = frame.src; }

/* ESCAPE */
function escapeNow(){ location.href="https://classroom.google.com"; }

/* Home search */
document.getElementById("homeSearch").addEventListener("keydown", e=>{
  if(e.key==="Enter"){ urlBox.value=e.target.value; load(); }
});
urlBox.addEventListener("keydown", e=>{ if(e.key==="Enter") load(); });

/* Init */
newTab();
</script>
</body>
</html>
